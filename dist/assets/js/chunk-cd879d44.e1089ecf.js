(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cd879d44"],{3445:function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"filtros-dinamicos"},[t("div",{staticClass:"filtros-header"},[t("h4",[t("i",{staticClass:"ti-filter"}),e._v("\n      Filtros ("+e._s(e.camposDisponibles.length)+" campos)\n    ")]),e.hasActiveFilters?t("button",{staticClass:"btn-clear-filters",on:{click:e.limpiarFiltros}},[t("i",{staticClass:"ti-close"}),e._v(" Limpiar\n    ")]):e._e()]),t("div",{staticClass:"filtros-content"},[0===e.camposDisponibles.length?t("div",{staticClass:"text-center text-muted"},[t("p",[e._v("No hay campos disponibles para filtrar")])]):t("div",{staticClass:"row"},e._l(e.camposDisponibles,(function(o){return t("div",{key:o.nombre||o,staticClass:"col-md-6 col-lg-4 mb-3"},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"form-label",attrs:{for:"filtro-"+(o.nombre||o)}},[e._v("\n            "+e._s((o.nombre||o).charAt(0).toUpperCase()+(o.nombre||o).slice(1))+"\n          ")]),"texto"===o.tipo||"email"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.filtros[o.nombre||o],expression:"filtros[campo.nombre || campo]"}],staticClass:"form-control",attrs:{id:"filtro-"+(o.nombre||o),type:"text",placeholder:"Filtrar por "+(o.nombre||o)},domProps:{value:e.filtros[o.nombre||o]},on:{input:[function(t){t.target.composing||e.$set(e.filtros,o.nombre||o,t.target.value)},e.aplicarFiltros]}}):"relacional"===o.tipo?t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros[o.nombre||o],expression:"filtros[campo.nombre || campo]"}],staticClass:"form-control",attrs:{id:"filtro-"+(o.nombre||o)},on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.filtros,o.nombre||o,t.target.multiple?a:a[0])},e.aplicarFiltros]}},[t("option",{attrs:{value:""}},[e._v("Todos")]),e._l(e.getOpcionesRelacionadas(o.seccion),(function(o){return t("option",{key:o,domProps:{value:o}},[e._v("\n              "+e._s(o)+"\n            ")])}))],2):e._e(),"relacional"===o.tipo?t("small",{staticClass:"text-muted"},[e._v("\n            Opciones: "+e._s(e.getOpcionesRelacionadas(o.seccion).length)+"\n          ")]):"fecha"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.filtros[o.nombre||o],expression:"filtros[campo.nombre || campo]"}],staticClass:"form-control",attrs:{id:"filtro-"+(o.nombre||o),type:"date"},domProps:{value:e.filtros[o.nombre||o]},on:{change:e.aplicarFiltros,input:function(t){t.target.composing||e.$set(e.filtros,o.nombre||o,t.target.value)}}}):"numero"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.filtros[o.nombre||o],expression:"filtros[campo.nombre || campo]"}],staticClass:"form-control",attrs:{id:"filtro-"+(o.nombre||o),type:"number",placeholder:"Filtrar por "+(o.nombre||o)},domProps:{value:e.filtros[o.nombre||o]},on:{input:[function(t){t.target.composing||e.$set(e.filtros,o.nombre||o,t.target.value)},e.aplicarFiltros]}}):e._e()])])})),0)])])},s=[],r=o("2b0e"),i={name:"FiltrosDinamicos",props:{camposDisponibles:{type:Array,default:()=>[]},secciones:{type:Array,default:()=>[]}},emits:["filtros-cambiados"],setup(e,{emit:t}){console.log("ðŸŽ¯ FiltrosDinamicos - Secciones recibidas:",e.secciones),console.log("ðŸŽ¯ FiltrosDinamicos - Campos disponibles:",e.camposDisponibles);const o=Object(r["ref"])({}),a=Object(r["computed"])(()=>Object.values(o.value).some(e=>e&&""!==e.toString().trim()));let s=null;const i=()=>{clearTimeout(s),s=setTimeout(()=>{const e={};Object.entries(o.value).forEach(([t,o])=>{o&&""!==o.toString().trim()&&(e[t]=o)}),t("filtros-cambiados",e)},300)},n=()=>{o.value={},t("filtros-cambiados",{})},l=t=>{console.log("ðŸ” Buscando opciones para secciÃ³n:",t),console.log("ðŸ“‹ Secciones disponibles:",e.secciones.map(e=>e.nombre));const o=e.secciones.find(e=>(e.slug||c(e.nombre))===(t?c(t):""));if(!o)return console.log("âŒ No se encontrÃ³ la secciÃ³n:",t),[];if(!o.columnas||0===o.columnas.length)return console.log("âŒ La secciÃ³n no tiene columnas:",o.nombre),[];const a=o.columnas[0].nombre;console.log("ðŸ”‘ Campo clave:",a);let s=[];if(!o.datos||!Array.isArray(o.datos))return console.log("âš ï¸ No hay datos disponibles para la secciÃ³n:",o.nombre),[];s=o.datos,console.log("âœ… Datos encontrados en seccion.datos:",s.length);const r=s.map(e=>e.valores&&void 0!==e.valores[a]?e.valores[a]:void 0!==e[a]?e[a]:null).filter(Boolean),i=[...new Set(r)];return console.log("ðŸ“Š Valores Ãºnicos encontrados:",i),i};function c(e){return e.toString().toLowerCase().normalize("NFD").replace(/[ \u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}return{filtros:o,hasActiveFilters:a,aplicarFiltros:i,limpiarFiltros:n,getOpcionesRelacionadas:l}}},n=i,l=(o("ed18"),o("2877")),c=Object(l["a"])(n,a,s,!1,null,"b3363d70",null);t["a"]=c.exports},"6f70":function(e,t,o){"use strict";o("af33")},"8a7f":function(e,t,o){},af33:function(e,t,o){},ed18:function(e,t,o){"use strict";o("8a7f")},fa4a:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var a=o("2b0e"),s=o("b9d1");const r=()=>{const e=Object(a["ref"])([]),t=Object(a["ref"])({}),o=Object(a["ref"])({}),r=Object(a["ref"])(!1),i=async(a,i={})=>{r.value=!0;try{const n={page:i.page||1,limit:i.limit||10,sortBy:i.sortBy||"createdAt",sortOrder:i.sortOrder||"desc"};i.filters&&Object.keys(i.filters).length>0&&(n.filters=i.filters),console.log("ðŸ” Enviando peticiÃ³n con parÃ¡metros:",{seccionId:a,queryParams:n});const l=await s["g"].getRegistrosPaginados(a,n);console.log("âœ… Respuesta recibida:",l),e.value=l.data,t.value=l.pagination,o.value=l.filters}catch(n){console.error("âŒ Error cargando registros:",n)}finally{r.value=!1}};return{registros:e,pagination:t,filters:o,loading:r,cargarRegistros:i}}},ff20:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"registros-paginados-container"},[t("div",{staticClass:"page-header"},[t("div",{staticClass:"header-content"},[t("h1",{staticClass:"page-title"},[t("i",{staticClass:"ti-database"}),e._v("\n        Registros Paginados - "+e._s(e.seccionActual&&e.seccionActual.nombre?e.seccionActual.nombre:"SecciÃ³n")+"\n      ")]),t("p",{staticClass:"page-subtitle"},[e._v("GestiÃ³n avanzada de registros con filtros y paginaciÃ³n")])])]),e.cargandoSeccion?t("div",{staticClass:"text-center"},[e._m(0)]):e.seccionActual?t("div",{staticClass:"main-content"},[t("FiltrosDinamicos",{attrs:{"campos-disponibles":e.seccionActual.columnas,pagination:e.pagination,secciones:e.secciones},on:{"filtros-cambiados":e.aplicarFiltros,"pagina-cambiada":e.cambiarPagina}}),t("div",{staticClass:"table-section"},[t("div",{staticClass:"table-header"},[t("h2",[e._v("Registros")]),t("div",{staticClass:"header-actions"},[t("button",{staticClass:"btn-add",on:{click:function(t){e.showAddModal=!0}}},[t("i",{staticClass:"ti-plus"}),e._v(" Agregar Registro\n          ")]),t("button",{staticClass:"btn-export",on:{click:e.exportarRegistros}},[t("i",{staticClass:"ti-download"}),e._v(" Exportar\n          ")])])]),e.loading?t("div",{staticClass:"loading-table"},[t("i",{staticClass:"ti-reload"}),t("p",[e._v("Cargando registros...")])]):t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-striped table-hover"},[t("thead",[t("tr",[e._l(e.seccionActual.columnas,(function(o){return t("th",{key:o.nombre,staticClass:"text-capitalize"},[e._v("\n                "+e._s(o.nombre.charAt(0).toUpperCase()+o.nombre.slice(1))+"\n              ")])})),t("th",{staticClass:"text-center"},[e._v("Acciones")])],2)]),t("tbody",e._l(e.registros,(function(o){return t("tr",{key:o._id},[e._l(e.seccionActual.columnas,(function(a){return t("td",{key:a.nombre},["relacional"===a.tipo?[t("span",{staticClass:"relational-value"},[e._v(e._s(o.valores[a.nombre]||"-"))])]:"fecha"===a.tipo?[t("span",{staticClass:"date-value"},[e._v(e._s(e.formatearFecha(o.valores[a.nombre])))])]:[t("span",{staticClass:"text-value"},[e._v(e._s(o.valores[a.nombre]||"-"))])]],2)})),t("td",{staticClass:"text-center"},[t("button",{staticClass:"btn-edit",attrs:{title:"Editar"},on:{click:function(t){return e.editarRegistro(o)}}},[t("i",{staticClass:"ti-pencil"})]),t("button",{staticClass:"btn-delete",attrs:{title:"Eliminar"},on:{click:function(t){return e.eliminarRegistro(o._id)}}},[t("i",{staticClass:"ti-trash"})])])],2)})),0)]),0===e.registros.length?t("div",{staticClass:"no-records"},[t("i",{staticClass:"ti-database"}),t("p",[e._v("No se encontraron registros")]),t("button",{staticClass:"btn-add",on:{click:function(t){e.showAddModal=!0}}},[t("i",{staticClass:"ti-plus"}),e._v(" Agregar primer registro\n          ")])]):e._e()])])],1):e._e(),t("b-modal",{attrs:{title:e.registroEditando?"Editar Registro":"Agregar Registro","hide-footer":""},model:{value:e.showAddModal,callback:function(t){e.showAddModal=t},expression:"showAddModal"}},[t("div",{staticClass:"row"},e._l(e.seccionActual&&e.seccionActual.columnas?e.seccionActual.columnas:[],(function(o){return t("div",{key:o.nombre,staticClass:"col-12 mb-3"},[t("div",{staticClass:"form-group"},[t("label",{staticClass:"form-label",attrs:{for:"campo-"+o.nombre}},[e._v("\n            "+e._s(o.nombre.charAt(0).toUpperCase()+o.nombre.slice(1))+"\n          ")]),"texto"===o.tipo||"email"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.nuevoRegistro[o.nombre],expression:"nuevoRegistro[columna.nombre]"}],staticClass:"form-control",attrs:{id:"campo-"+o.nombre,type:"text",placeholder:"Ingrese "+o.nombre},domProps:{value:e.nuevoRegistro[o.nombre]},on:{input:function(t){t.target.composing||e.$set(e.nuevoRegistro,o.nombre,t.target.value)}}}):"relacional"===o.tipo?t("select",{directives:[{name:"model",rawName:"v-model",value:e.nuevoRegistro[o.nombre],expression:"nuevoRegistro[columna.nombre]"}],staticClass:"form-control",attrs:{id:"campo-"+o.nombre},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.nuevoRegistro,o.nombre,t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Selecciona...")]),e._l(e.getOpcionesRelacionadas(o.seccion),(function(o){return t("option",{key:o,domProps:{value:o}},[e._v("\n              "+e._s(o)+"\n            ")])}))],2):"fecha"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.nuevoRegistro[o.nombre],expression:"nuevoRegistro[columna.nombre]"}],staticClass:"form-control",attrs:{id:"campo-"+o.nombre,type:"date"},domProps:{value:e.nuevoRegistro[o.nombre]},on:{input:function(t){t.target.composing||e.$set(e.nuevoRegistro,o.nombre,t.target.value)}}}):"numero"===o.tipo?t("input",{directives:[{name:"model",rawName:"v-model",value:e.nuevoRegistro[o.nombre],expression:"nuevoRegistro[columna.nombre]"}],staticClass:"form-control",attrs:{id:"campo-"+o.nombre,type:"number",placeholder:"Ingrese "+o.nombre},domProps:{value:e.nuevoRegistro[o.nombre]},on:{input:function(t){t.target.composing||e.$set(e.nuevoRegistro,o.nombre,t.target.value)}}}):e._e()])])})),0),t("div",{staticClass:"modal-actions"},[t("b-button",{staticClass:"mr-2",attrs:{variant:"primary"},on:{click:e.guardarRegistro}},[e._v("\n        "+e._s(e.registroEditando?"Actualizar":"Guardar")+"\n      ")]),t("b-button",{attrs:{variant:"secondary"},on:{click:e.cancelarEdicion}},[e._v("\n        Cancelar\n      ")])],1)])],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"loading-spinner"},[t("i",{staticClass:"ti-reload"}),t("p",[e._v("Cargando secciÃ³n...")])])}],r=o("2b0e"),i=o("8c4f"),n=o("b9d1"),l=o("fa4a"),c=o("3445"),u={name:"RegistrosPaginados",components:{FiltrosDinamicos:c["a"]},setup(){const e=Object(i["useRoute"])(),t=(Object(i["useRouter"])(),Object(r["ref"])(null)),o=Object(r["ref"])([]),a=Object(r["ref"])(!0),s=Object(r["ref"])(!1),c=Object(r["ref"])(null),u=Object(r["reactive"])({}),{registros:m,pagination:d,filters:p,loading:g,cargarRegistros:v}=Object(l["a"])(),b=async()=>{try{const s=e.params.seccionId,r=await n["g"].getById(s);t.value=r;const i=await n["g"].getAll();o.value=i,await v(s,{page:1,limit:10})}catch(s){console.error("Error cargando secciÃ³n:",s)}finally{a.value=!1}},f=async t=>{const o=e.params.seccionId;await v(o,{page:1,limit:10,filters:t})},C=async t=>{const o=e.params.seccionId;await v(o,{page:t,limit:10,filters:p.value.applied||{}})},_=async()=>{try{const o=e.params.seccionId,a={};t.value.columnas.forEach(e=>{a[e.nombre]=u[e.nombre]||""}),c.value?await n["g"].updateRegistro(o,c.value._id,a):await n["g"].createRegistro(o,a),await v(o,{page:d.value.currentPage||1,limit:10,filters:p.value.applied||{}}),y()}catch(o){console.error("Error guardando registro:",o),alert("Error al guardar el registro")}},h=e=>{c.value=e,t.value.columnas.forEach(t=>{u[t.nombre]=e.valores[t.nombre]||""}),s.value=!0},y=()=>{c.value=null,s.value=!1,t.value&&t.value.columnas&&t.value.columnas.forEach(e=>{u[e.nombre]=""})},R=async t=>{if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar este registro?"))try{const o=e.params.seccionId;await n["g"].deleteRegistro(o,t),await v(o,{page:d.value.currentPage||1,limit:10,filters:p.value.applied||{}})}catch(o){console.error("Error eliminando registro:",o),alert("Error al eliminar el registro")}},w=()=>{const e=JSON.stringify(m.value,null,2),o=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=(t.value&&t.value.nombre?t.value.nombre:"registros")+".json",s.click(),URL.revokeObjectURL(a)},A=e=>{const t=o.value.find(t=>(t.slug||O(t.nombre))===(e?O(e):""));if(!t||!t.columnas.length)return[];const a=t.columnas[0].nombre;return[...new Set(t.datos.map(e=>e[a]).filter(Boolean))]};function O(e){return e.toString().toLowerCase().normalize("NFD").replace(/[ \u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}const x=e=>e?new Date(e).toLocaleDateString("es-ES"):"-";return Object(r["onMounted"])(()=>{b()}),{seccionActual:t,secciones:o,cargandoSeccion:a,registros:m,pagination:d,filters:p,loading:g,showAddModal:s,registroEditando:c,nuevoRegistro:u,aplicarFiltros:f,cambiarPagina:C,guardarRegistro:_,editarRegistro:h,cancelarEdicion:y,eliminarRegistro:R,exportarRegistros:w,getOpcionesRelacionadas:A,formatearFecha:x}}},m=u,d=(o("6f70"),o("2877")),p=Object(d["a"])(m,a,s,!1,null,"2eeacb26",null);t["default"]=p.exports}}]);